{% load spellbook_tags %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ directory_name }} - Directory Index</title>
    {% spellbook_styles %}
    <link rel="stylesheet" href="{% static 'django_spellbook/css_modules/directory_index.css' %}">
</head>
<body class="sb-bg-background sb-text-color">
    <div class="sb-directory-index sb-p-4 sb-my-4 sb-w-full">
        <!-- Back to parent directory -->
        {% if parent_dir_url is not None %}
        <div class="sb-mb-4">
            <a href="/{{ parent_dir_url }}"
               class="sb-flex sb-items-center sb-gap-1 sb-text-sm sb-secondary sb-no-underline sb-hover:primary sb-transition">
                <span>‚Üê</span>
                <span>{{ parent_dir_name }}</span>
            </a>
        </div>
        {% endif %}

        <!-- Header -->
        <h2 class="sb-text-2xl sb-mb-4 sb-font-bold sb-text-text">{{ directory_name }}</h2>

        <!-- Subdirectories Section -->
        {% if subdirectories %}
        <div class="sb-rounded sb-border sb-p-3 sb-mb-6 sb-bg-secondary-25">
            <h3 class="sb-text-lg sb-font-bold sb-text-text sb-mb-3">Directories</h3>
            <div class="sb-grid sb-grid-cols-1 sb-gap-2">
                {% for subdir in subdirectories %}
                <a href="/{{ subdir.url }}"
                   class="sb-flex sb-items-center sb-justify-between sb-gap-2 sb-px-4 sb-py-4 sb-rounded sb-border sb-bg-background sb-no-underline sb-transition sb-hover:bg-secondary-10 sb-hover:border-primary">
                    <span class="sb-text-base sb-font-semibold sb-primary">{{ subdir.title }}</span>
                    <span class="sb-text-sm sb-text-text-secondary">{{ subdir.page_count }} page{{ subdir.page_count|pluralize }}</span>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Pages Section -->
        {% if pages %}
        <div class="sb-rounded sb-border sb-p-3 sb-bg-secondary-25">
            <h3 class="sb-text-lg sb-font-bold sb-text-text sb-mb-3">Pages</h3>
            <div class="sb-grid sb-grid-cols-1 sb-gap-3">
                {% for page in pages %}
                <a href="/{{ page.url }}" class="sb-block sb-px-4 sb-py-4 sb-rounded sb-border sb-bg-background sb-no-underline sb-transition sb-hover:bg-secondary-10 sb-hover:border-primary">
                    <div class="sb-flex sb-items-center sb-justify-between sb-gap-2 sb-mb-1">
                        <span class="sb-text-base sb-font-bold sb-primary">{{ page.title }}</span>
                    </div>

                    {% if page.description %}
                    <p class="sb-text-sm sb-text-text-secondary sb-mt-1 sb-mb-2">{{ page.description }}</p>
                    {% endif %}

                    {% if page.published or page.modified or page.tags %}
                    <div class="sb-flex sb-flex-wrap sb-items-center sb-gap-3 sb-mt-2 sb-text-sm">
                        {% if page.published %}
                        <div class="sb-flex sb-items-center sb-gap-1">
                            <span class="sb-font-semibold sb-text-text-secondary">Published:</span>
                            <span class="sb-text-text-secondary">{{ page.published|date:"d M Y" }}</span>
                        </div>
                        {% endif %}

                        {% if page.modified %}
                        <div class="sb-flex sb-items-center sb-gap-1">
                            <span class="sb-font-semibold sb-text-text-secondary">Modified:</span>
                            <span class="sb-text-text-secondary">{{ page.modified|date:"d M Y" }}</span>
                        </div>
                        {% endif %}

                        {% if page.tags %}
                        <div class="sb-flex sb-items-center sb-gap-1 sb-flex-wrap">
                            <span class="sb-font-semibold sb-text-text-secondary">Tags:</span>
                            {% for tag in page.tags %}
                            <span class="sb-bg-subtle sb-text-text-secondary sb-text-xs sb-px-2 sb-py-1 sb-rounded">{{ tag }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Empty State -->
        {% if not subdirectories and not pages %}
        <div class="sb-text-center sb-py-8 sb-text-text-secondary">
            <p class="sb-text-sm">This directory is empty.</p>
        </div>
        {% endif %}
    </div>
</body>
</html>
